<!DOCTYPE html>
<html>
<head>
    <title>Optimization Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f5f5f5; }
        .demo-box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #007bff; }
        code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; }
        .good { border-left-color: #28a745; }
        .bad { border-left-color: #dc3545; }
        h2 { color: #333; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Student Management System - Optimizations Explained</h1>
    <hr>

    <!-- Optimization 1 -->
    <h2>1Ô∏è‚É£ FAST STUDENT SEARCH (Database Indexing)</h2>
    
    <div class="demo-box bad">
        <h5>‚ùå SLOW WAY (Without Index)</h5>
        <pre><code>SELECT * FROM user WHERE usertype='student';</code></pre>
        <p><strong>What happens:</strong></p>
        <ul>
            <li>MySQL checks EVERY user row in database</li>
            <li>10,000 users? ‚Üí checks all 10,000</li>
            <li>Finding 100 students takes 10,000 comparisons</li>
            <li>Time: <strong>SLOW</strong> ‚ùå</li>
        </ul>
    </div>

    <div class="demo-box good">
        <h5>‚úÖ FAST WAY (With Index)</h5>
        <pre><code>CREATE INDEX idx_student_search ON user(usertype, class_id, username);</code></pre>
        <p><strong>What happens:</strong></p>
        <ul>
            <li>MySQL uses index to jump straight to <code>usertype='student'</code> rows</li>
            <li>10,000 users? ‚Üí jumps directly to ~100 student rows</li>
            <li>Finding 100 students takes ~100 comparisons</li>
            <li>Time: <strong>100x FASTER</strong> ‚úÖ</li>
        </ul>
        <p><strong>Real-world analogy:</strong> Book index vs reading every page</p>
    </div>

    <hr>

    <!-- Optimization 2 -->
    <h2>2Ô∏è‚É£ FAST PERMISSION CHECKING (Load Once at Login)</h2>
    
    <div class="demo-box bad">
        <h5>‚ùå SLOW WAY (Check database every time)</h5>
        <pre><code>// On EVERY page...
$sql = "SELECT permissions FROM roles WHERE role_id = " . $_SESSION['user_id'];
$result = query($sql); // Database hit!
if (in_array('edit_students', $result)) {
    // allow
}

// Student visits 10 pages? 
// = 10 database queries for same permissions!</code></pre>
        <p><strong>Problem:</strong> Database called for every page visit</p>
    </div>

    <div class="demo-box good">
        <h5>‚úÖ FAST WAY (Load once at login, use from memory)</h5>
        <pre><code>// At LOGIN TIME (happens once)
$_SESSION['permissions'] = getPermissionsForUser($user_id);
// Result: $_SESSION['permissions'] = ['view_students', 'edit_students', 'delete_students']

// On ANY PAGE (no database call!)
if (in_array('edit_students', $_SESSION['permissions'])) {
    // allow
}

// Student visits 10 pages?
// = 1 database query at login + 10 memory checks
// = 90% less database calls!</code></pre>
        <p><strong>Speed:</strong> Instant ‚úÖ</p>
        <p><strong>Real-world analogy:</strong> Security badge at entrance, use all day</p>
    </div>

    <hr>

    <!-- How to Use -->
    <h2>üí° How to Use These Optimizations</h2>

    <div class="demo-box">
        <h5>Permission Helper Functions (File: <code>permission_helper.php</code>)</h5>
        
        <h6>Function 1: Check single permission</h6>
        <pre><code>&lt;?php
if (hasPermission('edit_students')) {
    echo "&lt;a href='edit.php'&gt;Edit&lt;/a&gt;";
}
?&gt;</code></pre>

        <h6>Function 2: Require permission (die if denied)</h6>
        <pre><code>&lt;?php
// This page requires edit_students
requirePermission('edit_students');
// If user doesn't have it, page stops here
// If they do, page continues
?&gt;</code></pre>

        <h6>Function 3: Check if user has ANY of multiple permissions</h6>
        <pre><code>&lt;?php
if (hasAnyPermission(['edit_students', 'edit_teachers'])) {
    echo "User can edit EITHER students OR teachers";
}
?&gt;</code></pre>

        <h6>Function 4: Check if user has ALL of multiple permissions</h6>
        <pre><code>&lt;?php
if (hasAllPermissions(['edit_students', 'delete_students'])) {
    echo "User can BOTH edit AND delete students";
}
?&gt;</code></pre>
    </div>

    <hr>

    <!-- Performance Summary -->
    <h2>üìä Performance Summary</h2>

    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Operation</th>
                <th>Before</th>
                <th>After</th>
                <th>Improvement</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Search for 1 student among 10,000</td>
                <td>Scans ~10,000 rows</td>
                <td>Jumps to ~100 rows</td>
                <td><span class="badge bg-success">100x faster</span></td>
            </tr>
            <tr>
                <td>Check permissions on 1 page</td>
                <td>Database query</td>
                <td>Memory array check</td>
                <td><span class="badge bg-success">Instant</span></td>
            </tr>
            <tr>
                <td>10 page visits</td>
                <td>10 permission queries</td>
                <td>1 query + 10 checks</td>
                <td><span class="badge bg-success">90% faster</span></td>
            </tr>
        </tbody>
    </table>

    <hr>

    <!-- Interview Explanation -->
    <h2>üé§ How to Explain This in Interview</h2>

    <div class="demo-box good">
        <h5>üìù Your Answer (Simple & Clear)</h5>
        <blockquote class="blockquote">
            <p>"I optimized my student management project in two ways:</p>
            <p><strong>First,</strong> I added a database index on the user table for faster student search. Instead of MySQL scanning all user records, it jumps directly to student records using the index. This is like using a book's index instead of reading every page.</p>
            <p><strong>Second,</strong> I load user permissions once at login and store them in the session. Then on every page, I just check the permissions array in memory instead of querying the database each time. This reduces database calls significantly.</p>
            <p>Both changes are simple but make a big difference when working with real data."</p>
        </blockquote>
    </div>

    <hr>

    <!-- Implementation Status -->
    <h2>‚úÖ Implementation Status</h2>

    <div class="alert alert-success">
        <h5>Files Modified:</h5>
        <ul>
            <li>‚úÖ <strong>setup.sql</strong> - Added indexes</li>
            <li>‚úÖ <strong>login_check.php</strong> - Added permission loading at login</li>
            <li>‚úÖ <strong>permission_helper.php</strong> - Created new (helper functions)</li>
            <li>‚úÖ <strong>view_student.php</strong> - Updated to use permissions + documented index</li>
        </ul>
    </div>

    <div class="alert alert-info">
        <h5>What's Ready to Use:</h5>
        <ul>
            <li>Include <code>permission_helper.php</code> in any page</li>
            <li>Use <code>hasPermission()</code> to check permissions</li>
            <li>Use <code>requirePermission()</code> to block access</li>
            <li>Permissions already loaded at login automatically</li>
        </ul>
    </div>

</div>

</body>
</html>
